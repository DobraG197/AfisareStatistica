<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <title>Rezultate Turneu</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f2f2f2;
    }

    h2 {
      margin-top: 40px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #999;
      padding: 8px;
      text-align: center;
      background-color: #fff;
    }

    th {
      background-color: #e0e0e0;
    }

    .hidden-inputs {
      display: none;
    }
  </style>
</head>
<body>

  <h1>Rezultate Turneu din Local Storage</h1>

  <div id="meciuriGrupeContainer"></div>
  <div id="sferturiContainer"></div>
  <div id="statisticiContainer"></div>

  <script>
    function afiseazaMeciuri(idContainer, meciuriHTML, inputValues) {
      const container = document.getElementById(idContainer);
      const wrapper = document.createElement('div');

      const parser = new DOMParser();
      const htmlDoc = parser.parseFromString(meciuriHTML, 'text/html');
      const meciuri = htmlDoc.querySelectorAll('.match-item');

      let table = `<h2>Meciuri</h2><table>
        <tr><th>Ora</th><th>Grupa</th><th>Echipa 1</th><th>Goluri</th><th>Echipa 2</th><th>Teren</th></tr>`;

      meciuri.forEach(meci => {
        const span = meci.querySelector('span');
        const text = span.textContent.trim();

        const ora = text.match(/^\d{1,2}:\d{2} [APM]+/)[0];
        const grupa = text.match(/\| (Grupa [A-Z]) \|/)[1];
        const echipe = text.match(/\|\s(.+?)\s+vs\s+(.+?)\s+\|/);
        const teren = text.match(/\|\sTerenul\s\d+/)[0].replace('| ', '');

        const id = meci.id.match(/\d+/)[0];
        const g1 = inputValues[`goluri-${id}-1`] ?? '-';
        const g2 = inputValues[`goluri-${id}-2`] ?? '-';

        table += `<tr><td>${ora}</td><td>${grupa}</td><td>${echipe[1]}</td><td>${g1} - ${g2}</td><td>${echipe[2]}</td><td>${teren}</td></tr>`;
      });

      table += '</table>';
      wrapper.innerHTML = table;
      container.appendChild(wrapper);
    }

    function afiseazaSferturi(idContainer, sferturiHTML, inputValues) {
      const container = document.getElementById(idContainer);
      const wrapper = document.createElement('div');

      const parser = new DOMParser();
      const htmlDoc = parser.parseFromString(sferturiHTML, 'text/html');
      const meciuri = htmlDoc.querySelectorAll('.match-item');

      let table = `<h2>Sferturi de Finală</h2><table>
        <tr><th>Ora</th><th>Sfert</th><th>Echipa 1</th><th>Goluri</th><th>Echipa 2</th></tr>`;

      meciuri.forEach((meci, idx) => {
        const span = meci.querySelector('span');
        const text = span.textContent.trim();

        const ora = text.match(/^\d{1,2}:\d{2} [APM]+/)[0];
        const numeMeci = text.match(/\|\s(Sfert \d)/)[1];
        const echipe = text.match(/\|\s(.+?)\s+vs\s+(.+?)\s*$/);

        const g1 = inputValues[`goluri-sfert-${idx}-1`] ?? '-';
        const g2 = inputValues[`goluri-sfert-${idx}-2`] ?? '-';

        table += `<tr><td>${ora}</td><td>${numeMeci}</td><td>${echipe[1]}</td><td>${g1} - ${g2}</td><td>${echipe[2]}</td></tr>`;
      });

      table += '</table>';
      wrapper.innerHTML = table;
      container.appendChild(wrapper);
    }

    function calculeazaStatistici(grupe, inputValues) {
      const statistici = {};

      for (const grupa in grupe) {
        grupe[grupa].forEach(echipa => {
          statistici[echipa] = {
            meciuri: 0,
            victorii: 0,
            egaluri: 0,
            infrangeri: 0,
            goluriMarcate: 0,
            goluriPrimite: 0,
            puncte: 0,
          };
        });
      }

      for (const key in inputValues) {
        const match = key.match(/goluri-(\d+)-([12])/);
        if (!match) continue;

        const id = match[1];
        const scor1 = inputValues[`goluri-${id}-1`];
        const scor2 = inputValues[`goluri-${id}-2`];

        if (scor1 == null || scor2 == null) continue;

        const meciDiv = document.getElementById(`meci-${id}`);
        if (!meciDiv) continue;

        const span = meciDiv.querySelector('span');
        const text = span.textContent;
        const echipe = text.match(/\|\s(.+?)\s+vs\s+(.+?)\s+\|/);

        const e1 = echipe[1];
        const e2 = echipe[2];

        statistici[e1].meciuri++;
        statistici[e2].meciuri++;
        statistici[e1].goluriMarcate += scor1;
        statistici[e2].goluriMarcate += scor2;
        statistici[e1].goluriPrimite += scor2;
        statistici[e2].goluriPrimite += scor1;

        if (scor1 > scor2) {
          statistici[e1].victorii++;
          statistici[e2].infrangeri++;
          statistici[e1].puncte += 3;
        } else if (scor1 < scor2) {
          statistici[e2].victorii++;
          statistici[e1].infrangeri++;
          statistici[e2].puncte += 3;
        } else {
          statistici[e1].egaluri++;
          statistici[e2].egaluri++;
          statistici[e1].puncte += 1;
          statistici[e2].puncte += 1;
        }
      }

      return statistici;
    }

    function afiseazaStatistici(idContainer, statistici) {
      const container = document.getElementById(idContainer);
      let table = `<h2>Statistici Echipe</h2><table>
        <tr><th>Echipă</th><th>Meciuri</th><th>Victorii</th><th>Egaluri</th><th>Înfrângeri</th><th>Goluri+</th><th>Goluri-</th><th>Puncte</th></tr>`;

      for (const echipa in statistici) {
        const s = statistici[echipa];
        table += `<tr><td>${echipa}</td><td>${s.meciuri}</td><td>${s.victorii}</td><td>${s.egaluri}</td><td>${s.infrangeri}</td><td>${s.goluriMarcate}</td><td>${s.goluriPrimite}</td><td>${s.puncte}</td></tr>`;
      }

      table += `</table>`;
      container.innerHTML = table;
    }

    // === MAIN ===
    const allGroupResultsSaved = localStorage.getItem("allGroupResultsSaved");
    const meciuriGrupeHTML = localStorage.getItem("meciuriGrupe");
    const sferturiHTML = localStorage.getItem("sferturi");
    const inputValues = JSON.parse(localStorage.getItem("inputValues") || "{}");
    const grupe = JSON.parse(localStorage.getItem("grupe_turneu") || "{}");

    if (allGroupResultsSaved && meciuriGrupeHTML) {
      afiseazaMeciuri("meciuriGrupeContainer", meciuriGrupeHTML, inputValues);
    }

    if (sferturiHTML) {
      afiseazaSferturi("sferturiContainer", sferturiHTML, inputValues);
    }

    const statistici = calculeazaStatistici(grupe, inputValues);
    afiseazaStatistici("statisticiContainer", statistici);

  </script>
</body>
</html>
